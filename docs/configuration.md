# ğŸ› ï¸ GDOS é…ç½®æ‰‹å†Œ (Configuration Reference)

GDOS æ”¯æŒé€šè¿‡ **é…ç½®æ–‡ä»¶ (YAML)**ã€**ç¯å¢ƒå˜é‡** ä»¥åŠ **å‘½ä»¤è¡Œå‚æ•°** è¿›è¡Œé…ç½®ã€‚
é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼š**å‘½ä»¤è¡Œå‚æ•° > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼**ã€‚

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Master å’Œ Worker çš„ YAML é…ç½®æ–‡ä»¶ç»“æ„ã€‚

---

## 1. Master é…ç½® (`config.yaml`)

Master èŠ‚ç‚¹è´Ÿè´£å…ƒæ•°æ®å­˜å‚¨ã€API å“åº”åŠèŠ‚ç‚¹ç®¡ç†ã€‚é»˜è®¤æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ `config.yaml`ã€‚

```yaml
# ========================
# Server: HTTP æœåŠ¡åŸºç¡€é…ç½®
# ========================
server:
  port: ":8080"              # ç›‘å¬ç«¯å£
  db_path: "./ops_data.db"   # SQLite æ•°æ®åº“è·¯å¾„ (è‡ªåŠ¨åˆ›å»º)
  api_timeout: 10            # API æ¥å£é»˜è®¤è¶…æ—¶æ—¶é—´ (ç§’)
  # read_timeout: 0          # HTTP è¯»å–è¶…æ—¶ (0è¡¨ç¤ºä¸é™åˆ¶ï¼Œç”¨äº WebSocket/å¤§æ–‡ä»¶ä¸Šä¼ )
  # write_timeout: 0         # HTTP å†™å…¥è¶…æ—¶

# ========================
# Storage: æ–‡ä»¶å­˜å‚¨åç«¯ (äºŒé€‰ä¸€)
# ========================
storage:
  # type: "local" æˆ– "minio"
  type: "local"
  
  # [Local æ¨¡å¼] æ–‡ä»¶ä¸Šä¼ ä¿å­˜ç›®å½•
  upload_dir: "./uploads"

  # [MinIO æ¨¡å¼] S3 å…¼å®¹å¯¹è±¡å­˜å‚¨é…ç½®
  minio:
    endpoint: "127.0.0.1:9000"
    ak: "minioadmin"         # Access Key
    sk: "minioadmin"         # Secret Key
    bucket: "ops-packages"   # å­˜å‚¨æ¡¶åç§° (è‡ªåŠ¨åˆ›å»º)
    use_ssl: false           # æ˜¯å¦å¯ç”¨ HTTPS

# ========================
# Logic: ä¸šåŠ¡é€»è¾‘é˜ˆå€¼
# ========================
logic:
  # èŠ‚ç‚¹ç¦»çº¿åˆ¤å®šé˜ˆå€¼
  # è¶…è¿‡æ­¤æ—¶é—´æœªæ”¶åˆ° Worker å¿ƒè·³ï¼ŒMaster å°†æ ‡è®°èŠ‚ç‚¹ä¸º Offline
  node_offline_threshold: "30s"
  
  # Master ä¸»åŠ¨è¯·æ±‚ Worker çš„è¶…æ—¶æ—¶é—´
  http_client_timeout: "5s"

# ========================
# Auth: å®‰å…¨è®¤è¯
# ========================
auth:
  # Master ä¸ Worker é€šä¿¡çš„å…±äº«å¯†é’¥ (å¿…é¡»ä¿æŒä¸€è‡´)
  secret_key: "ops-system-secret-xxx"

# ========================
# Log: ç³»ç»Ÿè‡ªèº«æ—¥å¿—
# ========================
log:
  level: "info" # debug, info, error
```

---

## 2. Worker é…ç½® (`worker.yaml`)

Worker èŠ‚ç‚¹è´Ÿè´£è¿›ç¨‹æ‰˜ç®¡ã€æ—¥å¿—é‡‡é›†ä¸ç›‘æ§ä¸ŠæŠ¥ã€‚é»˜è®¤æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ `worker.yaml`ã€‚

```yaml
# ========================
# Server: Worker è‡ªèº«æœåŠ¡
# ========================
server:
  port: 8081                 # Worker ç›‘å¬ç«¯å£ (ä¾› Master è°ƒç”¨)
  work_dir: "./instances"    # å®ä¾‹è¿è¡Œå·¥ä½œç›®å½• (å­˜æ”¾éƒ¨ç½²çš„æœåŠ¡)

# ========================
# Connect: è¿æ¥ Master
# ========================
connect:
  master_url: "http://127.0.0.1:8080" # Master åœ°å€ (å¿…å¡«)

# ========================
# Logic: æ ¸å¿ƒé€»è¾‘å‚æ•°
# ========================
logic:
  # å‘ Master å‘é€å¿ƒè·³çš„é—´éš”
  heartbeat_interval: "5s"
  # é‡‡é›†æœ¬åœ°ç³»ç»Ÿç›‘æ§æŒ‡æ ‡(CPU/Mem)çš„é—´éš”
  monitor_interval: "3s"

# ========================
# Log Rotate: ä¸šåŠ¡æ—¥å¿—è½®è½¬ç­–ç•¥ (Critical)
# æ§åˆ¶è¢«æ‰˜ç®¡æœåŠ¡ stdout/stderr é‡å®šå‘å‡ºçš„ app.log
# ========================
log_rotate:
  # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ä½“ç§¯ (MB)
  max_size: 50
  
  # æœ€å¤šä¿ç•™æ—§æ–‡ä»¶ä¸ªæ•°
  max_backups: 5
  
  # æ—§æ–‡ä»¶æœ€å¤šä¿ç•™å¤©æ•°
  max_age: 7
  
  # æ˜¯å¦å‹ç¼©æ—§æ—¥å¿— (.gz)
  compress: true
  
  # [é‡è¦] å¯åŠ¨è¡Œä¸ºç­–ç•¥
  # true(é»˜è®¤): æ–°æ–‡ä»¶æ¨¡å¼ã€‚æ¯æ¬¡å¯åŠ¨æœåŠ¡å‰ï¼Œå¼ºåˆ¶å½’æ¡£æ—§æ—¥å¿—ï¼Œç”Ÿæˆå…¨æ–°çš„ app.logã€‚
  # false: è¿½åŠ æ¨¡å¼ã€‚é‡å¯æœåŠ¡æ—¶ï¼Œç»§ç»­å†™åœ¨åŸ app.log åé¢ã€‚
  rotate_on_start: true

# ========================
# Auth: å®‰å…¨è®¤è¯
# ========================
auth:
  # å¿…é¡»ä¸ Master é…ç½®ä¸€è‡´
  secret_key: "ops-system-secret-xxx"
```

---

## 3. ç¯å¢ƒå˜é‡è¦†ç›– (Environment Variables)

æ”¯æŒä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼Œæ–¹ä¾¿å®¹å™¨åŒ–éƒ¨ç½²ã€‚

*   **Master å‰ç¼€**: `OPS_MASTER_`
*   **Worker å‰ç¼€**: `OPS_WORKER_`
*   **è§„åˆ™**: å±‚çº§ç”¨ä¸‹åˆ’çº¿ `_` ä»£æ›¿ã€‚

**ç¤ºä¾‹ï¼š**

1.  **ä¿®æ”¹ Master ç«¯å£**:
    `OPS_MASTER_SERVER_PORT=:9090 ./master`

2.  **ä¿®æ”¹ Worker è¿æ¥çš„ Master åœ°å€**:
    `OPS_WORKER_CONNECT_MASTER_URL=http://192.168.1.100:8080 ./worker`

3.  **ä¿®æ”¹ Worker çš„ Secret**:
    `OPS_WORKER_AUTH_SECRET_KEY=my-secure-token ./worker`
